{% extends "base.html" %}

{% block content %}
<h3>weekly report generator</h3>
<div class="row justify-content-center">
    <div class="col-md-10">
        <p class="text-muted mb-3">Generate comprehensive time tracking reports for any date range</p>

        <div class="card mb-2">
            <div class="card-body">
                <form method="POST" action="/reports/weekly">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="start_date" class="form-label">
                                    <i class="bi bi-calendar-event"></i> start date
                                </label>
                                <input type="date" id="start_date" name="start_date" class="form-control"
                                    value="{{ default_start_date }}" required>
                                <div class="form-text">First day of the report period</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="end_date" class="form-label">
                                    <i class="bi bi-calendar-check"></i> end date
                                </label>
                                <input type="date" id="end_date" name="end_date" class="form-control"
                                    value="{{ default_end_date }}" required>
                                <div class="form-text">Last day of the report period</div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12">
                            <div class="mb-3">
                                <div class="card bg-light">
                                    <div class="card-body p-3">
                                        <h6 class="card-title mb-2">
                                            <i class="bi bi-info-circle"></i> what's included
                                        </h6>
                                        <ul class="mb-0 small">
                                            <li>Daily time entries with start/end times and activities</li>
                                            <li>Weekly summary with total hours and averages</li>
                                            <li>Activity breakdown with time distribution</li>
                                            <li>Daily totals and working patterns</li>
                                            <li>Print-friendly format for record keeping</li>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex justify-content-between">
                        <a href="/" class="btn btn-secondary">
                            <i class="bi bi-arrow-left"></i> back to home
                        </a>
                        <div class="btn-group">
                            <button type="button" class="btn btn-outline-primary" id="thisWeekBtn">
                                <i class="bi bi-calendar-week"></i> this week
                            </button>
                            <button type="button" class="btn btn-outline-primary" id="lastWeekBtn">
                                <i class="bi bi-calendar-minus"></i> last week
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-file-earmark-bar-graph"></i> generate report
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const startDateInput = document.getElementById('start_date');
        const endDateInput = document.getElementById('end_date');
        const thisWeekBtn = document.getElementById('thisWeekBtn');
        const lastWeekBtn = document.getElementById('lastWeekBtn');

        // Function to get the start of week (Sunday)
        function getStartOfWeek(date) {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - day;
            return new Date(d.setDate(diff));
        }

        // Function to get the end of week (Saturday)
        function getEndOfWeek(date) {
            const startOfWeek = getStartOfWeek(date);
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6);
            return endOfWeek;
        }

        // Function to format date for input
        function formatDateForInput(date) {
            return date.toISOString().split('T')[0];
        }

        // This Week button handler
        thisWeekBtn.addEventListener('click', function () {
            const today = new Date();
            const startOfWeek = getStartOfWeek(today);
            const endOfWeek = getEndOfWeek(today);

            startDateInput.value = formatDateForInput(startOfWeek);
            endDateInput.value = formatDateForInput(endOfWeek);
        });

        // Last Week button handler
        lastWeekBtn.addEventListener('click', function () {
            const today = new Date();
            const lastWeekStart = new Date(today);
            lastWeekStart.setDate(today.getDate() - 7);

            const startOfLastWeek = getStartOfWeek(lastWeekStart);
            const endOfLastWeek = getEndOfWeek(lastWeekStart);

            startDateInput.value = formatDateForInput(startOfLastWeek);
            endDateInput.value = formatDateForInput(endOfLastWeek);
        });

        // Validate that end date is not before start date
        function validateDates() {
            const startDate = new Date(startDateInput.value);
            const endDate = new Date(endDateInput.value);

            if (endDate < startDate) {
                endDateInput.setCustomValidity('End date must be after start date');
            } else {
                endDateInput.setCustomValidity('');
            }
        }

        startDateInput.addEventListener('change', validateDates);
        endDateInput.addEventListener('change', validateDates);
    });
</script>

<style>
    /* Add some bottom space for the page */
    .container {
        margin-bottom: 2rem;
    }

    /* Style form elements consistently */
    .form-label {
        font-weight: 500;
    }

    .btn-group .btn {
        border-radius: 0.375rem;
    }

    .btn-group .btn:not(:last-child) {
        margin-right: 0.5rem;
    }
</style>

{% endblock %}